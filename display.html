<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Screen blocker</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <div id="defaultMessage">
            <p>
                Toutes les bonnes choses ont une fin, votre temps est écoulé.<br>
                Si vous souhaitez prolonger, veuillez ajouter du temps à votre réservation<br>
                via l'application Le Birdie.
            </p>
            <hr>
            <p>
                All good things come to an end, your time is up.<br>
                If you would like to extend, please add time to your booking<br>
                via the Le Birdie app.
            </p>
        </div>
        <div id="padlock">
            <img src="padlock.png" alt="Padlock">
        </div>
    </div>
    <script>
        // Helper to get URL query parameters.
        const getQueryParam = param => new URLSearchParams(window.location.search).get(param);

        document.addEventListener("DOMContentLoaded", () =>
        {
            const msg = getQueryParam("msg");
            const defaultMessageEl = document.getElementById("defaultMessage");
            const padlockEl = document.getElementById("padlock");
            const container = document.querySelector(".container");

            // Function to initialize and animate the padlock
            const revealPadlock = () =>
            {
                // Set initial random position
                const containerWidth = container.clientWidth;
                const containerHeight = container.clientHeight;
                let pPosX = Math.random() * (containerWidth - 100);
                let pPosY = Math.random() * (containerHeight - 100);
                padlockEl.style.left = `${pPosX}px`;
                padlockEl.style.top = `${pPosY}px`;

                // Fade in the padlock
                padlockEl.style.transition = "opacity 1s";
                padlockEl.style.opacity = "1";
                const padlockImg = padlockEl.querySelector("img");
                setTimeout(() =>
                {
                    padlockImg.style.transition = "opacity 1s";
                    padlockImg.style.opacity = "0.25"; // optional transparency
                }, 50);

                // Initialize velocity for bounce animation
                let pVx = ((Math.random() * 2 + 1) * (Math.random() < 0.5 ? 1 : -1)) * 0.5;
                let pVy = ((Math.random() * 2 + 1) * (Math.random() < 0.5 ? 1 : -1)) * 0.5;

                const animatePadlock = () =>
                {
                    pPosX += pVx;
                    pPosY += pVy;
                    const pWidth = padlockImg.offsetWidth || 100;
                    const pHeight = padlockImg.offsetHeight || 100;

                    // Horizontal boundaries
                    if (pPosX < 0)
                    {
                        pPosX = 0;
                        pVx = Math.abs(pVx);
                    } else if (pPosX + pWidth > containerWidth)
                    {
                        pPosX = containerWidth - pWidth;
                        pVx = -Math.abs(pVx);
                    }

                    // Vertical boundaries
                    if (pPosY < 0)
                    {
                        pPosY = 0;
                        pVy = Math.abs(pVy);
                    } else if (pPosY + pHeight > containerHeight)
                    {
                        pPosY = containerHeight - pHeight;
                        pVy = -Math.abs(pVy);
                    }

                    padlockEl.style.left = `${pPosX}px`;
                    padlockEl.style.top = `${pPosY}px`;
                    requestAnimationFrame(animatePadlock);
                };
                requestAnimationFrame(animatePadlock);
            };

            // Modify message if "backtoback"
            if (msg === "backtoback")
            {
                defaultMessageEl.innerHTML = `
                    <p>
                        Toutes les bonnes choses ont une fin,<br>
                        la prochaine réservation est prête à débuter.<br>
                        Bonne journée!
                    </p>
                    <hr>
                    <p>
                        All good things come to an end,<br>
                        the next booking is ready to begin.<br>
                        Have a great day!
                    </p>`;
            }
            else if (msg === "boot")
            {
                // Immediately hide the default message and reveal the padlock.
                defaultMessageEl.style.display = "none";
                revealPadlock();
                return;
            }

            // Fade in the default message after 1s.
            setTimeout(() =>
            {
                defaultMessageEl.classList.add("visible");
            }, 1000);

            // For non-"backtoback" messages, wait 20s then fade out default message and reveal padlock.
            if (msg !== "backtoback")
            {
                setTimeout(() =>
                {
                    defaultMessageEl.style.transition = "opacity 1s";
                    defaultMessageEl.style.opacity = "0";
                    setTimeout(() =>
                    {
                        defaultMessageEl.style.display = "none";
                        revealPadlock();
                    }, 1000);
                }, 20000);
            }
        });
    </script>
</body>

</html>